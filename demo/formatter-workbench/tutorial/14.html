<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="tutorial.css">
  <script src="index.js"></script>
</head>
<body>
<h2 class="continued">Localizers tab</h2>

The following Activity creates a simple localizer from scratch.

<p>Be sure to see the <a class="tab">Code Snippets</a> tab for insights how to do this <em>programmatically</em> (in code, without this app).</p>

<article class="activity">
  <header><div>7</div>Define, register, and bind a new localizer</header>
  <section>
    <h4>7.1: Define</h4>
    <ol>
      <li>Switch to the <a class="tab">Localizers</a> tab.</li>
      <li>Select <strong>(New)</strong> from the <em>Load localizer</em> drop-down.</li>
      <li>Rename it with a unique name by editing the <a target="doc" href="https://fin-hypergrid.github.io/core/doc/localizerInterface.html#name" class="code">name</a> field.</li>
      <li>Add local variables, as needed, by declaring them at the top.</li>
      <li>Code your localizer referring to examples and the <a target="doc" href="https://fin-hypergrid.github.io/core/doc/localizerInterface.html" class="code">localizer interface</a> documentation.</li>
      <li>Be sure to assign your localizer to <code>module.exports</code>.</li>
    </ol>

    For example, here’s a file containing a localizer to show a “degrees” unit:
    <pre>module.exports = {
    name: 'deg',
    format: function(s) { return s + '°' },
    parse: function(s) { return parseInt(s, 10); }
}</pre>

    <h4>7.3: Register</h4>
    Now register your new localizer with the grid:
    <ol start="7">
      <li>Click the <span class="button">grid.localization.add(…)</span> button.</li>
    </ol>

    <h4>7.3: Bind</h4>

    Once a localizer is registered in the grid, it can be bound to a cell (or column, <i>etc.</i>) through its
    <a target="doc" href="https://fin-hypergrid.github.io/core/doc/localizerInterface.html#format" class="code">format</a> property,
    which can be set declaratively using a grid state object:

    <ol start="8">
      <li>Go back to the <a class="tab">State</a> tab.</li>
      <li>Edit the state object to set the <code>prevclose</code> column’s <code>format</code> property to <code>'deg'</code>.</li>
      <li>Click the <span class="button">grid.setState(…)</span> button.</li>
      <li>Observe: The values in the grid are now rendered with a degrees symbol.</li>
    </ol>

    <h4>7.4: Update</h4>
    The <span class="button">grid.localization.add(…)</span> button can also be used to update a localizer already known to the grid:

    <ol start="12">
      <li>Switch back to the <a class="tab">Localizers</a> tab.</li>
      <li>Make a minor edit to your localizer code.</li>
      <li>Click the <span class="button">grid.localization.add(…)</span> button again.</li>
    </ol>
  </section>
</article>

Because we’re using <em>loose binding</em>, the cell’s <code>format</code> property remains bound even when the referenced object is subsequently updated (as above) or replaced.

<p>In general, note the following regarding Hypergrid properties that bind cells to objects:</p>
<ul>
  <li>Cells are bound with a string containing the name of a <em>registered</em> object</li>
  <li>The strings are <em>not</em> case sensitive</li>
  <li>Each property refers to items in a specific <em>registry,</em> each oif which has its own namespace</li>
  <li>Invalid references are ignored</li>
</ul>

On the next page we discuss cell editors.

<div class="snippet">
  <h2 class="continued">Localizers tab</h2>

  The code snippets below accomplish <em>programmatically</em> the same objective as <strong>Activity 7</strong> in the <a class="tab">Tutorial</a> tab.

  <p>This time, we’ll define a localizer that we’ll call <code>pct</code> to format the <code>change</code> column as percentages.</p>

  <h3>Define, register, and bind a localizer Programmatically</h3>

  <p>
    To set properties at run-time, you could submit a partial state object through the
    <a target="doc" href="https://fin-hypergrid.github.io/core/doc/Hypergrid.html#addState" class="code">addState(state)</a> method,
    which sets additional state, non-destructively.
    However, it’s usually cleaner to make direct API calls, as shown below.
  </p>

  <h4>Define</h4>
  <pre>var localizer = {
    name: 'pct',
    format: function(n) { return (n * 100).toFixed(3) + '%'; },
    parse: function(s) { return parseInt(s, 10) / 100; }
};</pre>

  The above <code>format</code> method performs a calculation before appending the percent sign (%).
  This is perfectly acceptable, although another approach might be to use a <em>computed column</em> (an entirely separate topic).

  <h4>Register</h4>
  To register a cell editor with the grid instance:
  <pre>grid.localization.add(pct);</pre>

  Localizers are not actually required to have a <a class="code" target="doc" href="https://fin-hypergrid.github.io/core/doc/localizerInterface.html#name">name</a> property.
  They can alternatively be named at registration time with an optional first parameter:
  <pre>grid.localization.add('pct', localizer);</pre>
  When specified, the optional first parameter overrides the given localizer’s <code>name</code> property (if present).

  <h4>Bind</h4>
  To bind the localizer, reference it by name in the <code>format</code> property.
  <p>For example, here we set the <code>format</code> property for the entire <code>change</code> column:</p>
  <pre>grid.behavior.getColumn('change').properties.format = 'PCT'; // case-insensitive</pre>

  Following are examples of other possible bindings.

  <h4>Example: Setting a grid property programmatically</h4>
  <pre>var propName = 'format'; // for example
var propValue = 'pct'; // for example
grid.properties[propName] = propValue;</pre>

  <h4>Example: Setting a column property programmatically</h4>
  Set a column property directly on the <code>column.properties</code> object.
  To get a column object, you need either its index or its name:
  <pre>var columnIndex = 3; // fourth column
var column = grid.behavior.getActiveColumn(columnIndex);

// or:
var columnName = 'change';
var column = grid.behavior.getActiveColumn(columnName);

column.properties[propName] = propValue;</pre>

  Once you have the column object, you have access to both <code>column.index</code> and <code>column.name</code> (among other props).

  <h4>Example: Setting a row property programmatically</h4>
  <pre>var rowIndex = 5; // the sixth row, for example
grid.behavior.setRowProperty(rowIndex, propName, propValue);</pre>

  <h4>Example: Setting a cell property programmatically</h4>
  Cell properties can be set when you already have a <code>column</code> object:
  <pre>column.setCellProperty(rowIndex, propName, propValue);</pre>
  Or when you just have a <code>columnIndex</code>:
  <pre>grid.behavior.setCellProperty(columnIndex, rowIndex, propName, propValue);</pre>
</div>